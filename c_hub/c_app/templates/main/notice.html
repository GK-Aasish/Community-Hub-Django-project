<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Notice Board</title>
  {% load static %}
  <link href="{% static 'src/styles.css' %}" rel="stylesheet" />
  <script src="https://kit.fontawesome.com/b480fa4bf0.js" crossorigin="anonymous"></script>
</head>
<body class="bg-gray-50">
  <div class="flex h-screen">
    {% include "components/sidebar.html" %}

    <main class="flex-1 flex flex-col">
      <section class="p-6 overflow-y-auto scrollbar-none">
        <div class="w-full h-[680px] bg-white border border-dashed border-gray-300 rounded-xl p-6 overflow-y-scroll scrollbar-hide">

          <!-- TOP BAR -->
          <div class="flex items-center justify-between mb-6">
            <h1 class="text-xl font-semibold text-gray-700">Notice Board</h1>
            <div class="flex items-center gap-3">
              <!-- FILTER -->
              <select class="text-sm border border-gray-200 rounded-md px-3 py-1.5 text-gray-600 focus:outline-none focus:ring-1 focus:ring-gray-300">
                <option>All Notices</option>
                <option>General</option>
                <option>Academic</option>
                <option>Urgent</option>
              </select>

              <!-- ADD NOTICE BUTTON -->
              <button onclick="openNoticeModal('create')" class="flex items-center gap-1.5 text-sm bg-gray-800 text-white px-4 py-1.5 rounded-md hover:bg-gray-700 transition">
                <i class="fa-solid fa-plus text-xs"></i>
                Add Notice
              </button>
            </div>
          </div>

          <!-- NOTICE LIST -->
          <div id="noticeList" class="space-y-4">
            <!-- Example Card -->
            {% if notices %}
              {% for notice in notices %}
                <div class="relative border-l-4 border-blue-500 rounded-xl p-6 bg-white shadow-md hover:shadow-xl transition duration-300">
                  <div class="flex justify-between items-start">
                    <div>
                      <!--This is title-->
                      <h2 class="text-xl font-bold text-gray-800">{{notice.title}}</h2>
                      <!--This is category-->
                      <p class="text-xs text-gray-500 mt-1">{{notice.category}}</p>
                    </div>
                    <div class="flex items-center gap-2">
                      <!--Username-->
                      <span class="text-xs bg-blue-100 text-blue-600 px-3 py-1 rounded-full font-semibold">User</span>
                      <button onclick="toggleActions(this)" class="text-gray-400 hover:text-gray-600 transition">
                        <i class="fa-solid fa-chevron-down"></i>
                      </button>
                    </div>
                  </div>
                  <!--Description-->
                  <p class="text-sm text-gray-600 mt-4 leading-relaxed">
                    {{notice.description}}
                  </p>
                  <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mt-5 gap-3">
                    <!--created and updated times-->
                    <div class="flex items-center gap-2 text-gray-500 text-sm">
                      <i class="fa-regular fa-clock"></i>
                      <span>{{notice.created_at}}</span>
                    </div>
                    <!-- This is reactions & Comment-->
                    <div class="flex items-center gap-2 flex-wrap">
                      <button class="flex items-center gap-1 px-3 py-1 bg-blue-50 text-blue-600 rounded-full text-sm hover:bg-blue-100 hover:scale-105 transition">
                        <i class="fa-regular fa-thumbs-up"></i>
                        <span class="bg-blue-600 text-white px-2 py-0.5 rounded-full text-xs">12</span>
                      </button>
                      <button class="flex items-center gap-1 px-3 py-1 bg-red-50 text-red-600 rounded-full text-sm hover:bg-red-100 hover:scale-105 transition">
                        <i class="fa-regular fa-thumbs-down"></i>
                        <span class="bg-red-600 text-white px-2 py-0.5 rounded-full text-xs">1</span>
                      </button>
                      <button class="flex items-center gap-1 px-3 py-1 bg-green-50 text-green-600 rounded-full text-sm hover:bg-green-100 hover:scale-105 transition">
                        <i class="fa-regular fa-comment"></i>
                        <span class="bg-green-600 text-white px-2 py-0.5 rounded-full text-xs">4</span>
                      </button>
                    </div>
                  </div>
                  <div class="mt-4 hidden actions-container flex gap-2 flex-wrap">
                    <button class="px-3 py-1 text-sm rounded-md bg-green-600 text-white hover:bg-green-700 transition" onclick="editNotice(this)">Edit</button>
                    <button class="px-3 py-1 text-sm rounded-md bg-red-600 text-white hover:bg-red-700 transition" onclick="deleteNotice(this)">Delete</button>
                  </div>
                </div>
                {% endfor %}
              {% else %}
            <p>No notices available.</p>
            {% endif %}
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- CREATE/EDIT NOTICE MODAL -->
  <div id="createNoticeModal" class="fixed inset-0 bg-black/30 hidden items-center justify-center z-50" onclick="closeNoticeModal('create')">
    {% include "components/notice_model.html" with mode='create' %}
  </div>
  <div id="editNoticeModal" class="fixed inset-0 bg-black/30 hidden items-center justify-center z-50" onclick="closeNoticeModal('edit')">
    {% include "components/notice_model.html" with mode='edit' %}
  </div>

  <script>
    // MODALS
    function openNoticeModal(mode) {
      const modalId = mode === 'create' ? 'createNoticeModal' : 'editNoticeModal';
      document.getElementById(modalId).classList.remove('hidden');
      document.getElementById(modalId).classList.add('flex');
    }

    function closeNoticeModal(mode) {
      const modalId = mode === 'create' ? 'createNoticeModal' : 'editNoticeModal';
      document.getElementById(modalId).classList.add('hidden');
      document.getElementById(modalId).classList.remove('flex');
    }

    // Toggle Edit/Delete buttons
    function toggleActions(btn) {
      const card = btn.closest('div.border-l-4');
      const actions = card.querySelector('.actions-container');
      actions.classList.toggle('hidden');
      const icon = btn.querySelector('i');
      icon.classList.toggle('fa-rotate-180');
    }

    // Delete notice
    function deleteNotice(button) {
      if (confirm("Are you sure you want to delete this notice?")) {
        const card = button.closest('div.border-l-4');
        card.remove();
      }
    }

    // Edit notice: fill modal with card data
    function editNotice(button) {
      const card = button.closest('div.border-l-4');
      const title = card.querySelector('h2').innerText;
      const category = card.querySelector('p.text-xs').innerText;
      const description = card.querySelector('p.text-sm').innerText;

      // Fill modal inputs
      document.getElementById('edit_title').value = title;
      document.getElementById('edit_category').value = category;
      document.getElementById('edit_description').value = description;

      // Open edit modal
      openNoticeModal('edit');
    }
  </script>
</body>
</html>
